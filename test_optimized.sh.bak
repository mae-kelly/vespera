#!/bin/bash
echo "ğŸš€ TESTING OPTIMIZED SYSTEM"
echo "Starting Python cognition layer..."
python3 main.py --mode=dry &
PYTHON_PID=$!
echo "Python PID: $PYTHON_PID"

sleep 3

echo "Starting Rust executor..."
timeout 30s ./hft_executor || true

echo "Stopping Python..."
kill $PYTHON_PID 2>/dev/null || true

echo "ğŸ“Š Test results:"
if [ -f "/tmp/fills.json" ]; then
    echo "âœ… Fills generated:"
    cat /tmp/fills.json | grep -o '"asset":"[^"]*"' | wc -l
else
    echo "âŒ No fills generated"
fi

if [ -f "/tmp/signal.json" ]; then
    echo "âœ… Latest signal confidence:"
    cat /tmp/signal.json | grep -o '"confidence":[0-9.]*' | tail -1
else
    echo "âŒ No signals generated"
fi
